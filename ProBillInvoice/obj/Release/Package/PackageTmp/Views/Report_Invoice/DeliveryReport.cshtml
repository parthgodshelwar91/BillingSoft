@model ProBillInvoice.Models.SaleInvoiceModel

@{
    ViewBag.Title = "DeliveryReport";
    int SrNo = 0;
    int MaterialId = 0;
    decimal TotalInvoiceQty = 0;
    decimal TotalInvoiceAmount = 0;
    decimal GrandTotalAmount = 0;
    decimal GrandTotalQty = 0;
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <div class="row">
            <div class="col-xl-3">
                <div class="card">
                    <div class="card-header" style="padding: 13px 15px;">
                        <h5 class="card-title float-start mt-2" style="font-size:20px;">Sale Invoice</h5>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div class="mx-n3" style="overflow:auto; max-height:72vh;">
                            <div data-simplebar data-simplebar-auto-hide="false" data-simplebar-track="secondary" @*style="max-height: 100%; height: 100vh;"*@>
                                <div class="list-group list-group-flush zopage-right-panel" title="Click here to view detail">
                                    @foreach (var item in Model.InvoiceHeader)
                                    {
                                        <a href="@Url.Action("SaleInvoice_View", "Report_Invoice", new {InvoiceId = item.sale_invoice_id, PartyId = item.party_id })" class="list-group-item">
                                            <div class="fst-stage">
                                                <h5 class="partyname">@Html.DisplayFor(modelItem => item.party_name)</h5>
                                                <span class="partyvalueprice"><i class="las la-rupee-sign"></i> @String.Format("{0:N2}", item.total_amount)/-</span>
                                            </div>
                                            <div class="snd-stage">
                                                <span class="poiddate">@Html.DisplayFor(modelItem => item.invoice_no)</span><span class="podate">@string.Format("{0:dd/MM/yyyy}", item.invoice_date)</span>
                                            </div>
                                            <div class="thd-stage">
                                                <span class="grnno">@Html.DisplayFor(modelItem => item.company_name)</span><span class="grnvalue"><i></i> @string.Format("{0:dd/MM/yyyy}", item.site_name)</span>
                                            </div>
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-9">
                <div class="row">
                    <div class="card">
                        <div class="card-header pb-0">
                            <div class="row">
                                <div class="col-6">
                                    <div class="zopage-header align-items-center">
                                        <h4>@Html.DisplayFor(model => model.InvoiceHeaderSearch.invoice_no)</h4>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="zopageclose"><a href="@Url.Action("Index","SaleInvoice")" title="Close"><i class="las la-window-close mt-1" style="color: red;"></i></a></div>
                                    @*<div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item"><a href="javascript: void(0);">Advance UI</a></li>
                                                <li class="breadcrumb-item active">Scrollbar</li>
                                            </ol>
                                        </div>*@
                                </div>
                            </div>

                            <div class="row bg-light border-bottom border-top bg-opacity-25">
                                <div class="col-12">
                                    <div class="zopage-controler">
                                        <ul>
                                            <li><a href="@Url.Action("Edit","SaleInvoice",new { Id = Model.InvoiceHeaderSearch.sale_invoice_id})" class="breadcrumb-item" title="Click here to edit"><i class="las la-edit" style="color:#4db6ac"></i> Edit</a></li>
                                            <li><a href="@Url.Action("Email","SaleInvoice",new { Id = Model.InvoiceHeaderSearch.sale_invoice_id})" class="breadcrumb-item" title="Click here to sent mail"><i class="las la-envelope" style="color:#9575cd"></i> Sent</a></li>
                                            <li><a href="#" class="breadcrumb-item" title="Click here to share document"><i class="las la-share-square" style="color:dodgerblue"></i> Share</a></li>
                                            <li><a href="#" id="btnPrint" class="breadcrumb-item" title="Click here to PDF/Print document"><i class="las la-file-pdf" style="color:#FF0000"></i> PDF/Print</a></li>
                                            <li><a href="#" class="breadcrumb-item" title="Click here to convert"><i class="las la-box" style="color:#cea711"></i> Convert</a></li>

                                            <li><a href="@Url.Action("SaleInvoiceReport_Consolidated", "Report_Invoice", new { InvoiceId = Model.InvoiceHeaderSearch.sale_invoice_id, PartyId = Model.InvoiceHeaderSearch.party_id})" class="breadcrumb-item" title="Click Here To Report View"><i class="bx bx-printer"></i>Sale Inv</a></li>
                                            <li><a href="@Url.Action("DeliveryReport", "Report_Invoice", new { InvoiceId = Model.InvoiceHeaderSearch.sale_invoice_id, PartyId = Model.InvoiceHeaderSearch.party_id})" class="breadcrumb-item" title="Click Here To Report View"><i class="bx bx-printer"></i>Sale Delivery</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-body pt-0">
                            <div class="row" style="overflow:auto; max-height:70vh;">
                                <div class="col-12" style="width:100%; margin: 0 auto; overflow: auto; max-width: 820px;">
                                    <div style="width: 21cm !important; display: flex; justify-content: center; align-items: center; margin: 0 auto; padding-bottom: 50px;">
                                        <div id="printable">
                                            <div class="pb-0" style="min-height: 700px; padding: 0px; font-size: 14px;">
                                                <div class="row p-4" style="margin-left: 2px;">
                                                    <div class="col-12">
                                                        <div class="form-group">
                                                            <div class="row">
                                                                <div class="col-12 mb-3" style="border-top:1px solid black; border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black ">
                                                                    <div>
                                                                        @Html.HiddenFor(model => model.InvoiceHeaderSearch.PartyId)
                                                                    </div>
                                                                    <div class="row mb-1">
                                                                        <div class="col-2" style="text-align:center;padding:10px">
                                                                            <img src="~/assets/images/rmcsoftware72.png" alt="RMC Software (Ready Mix Concrete)" title="Stamp" height="100">
                                                                        </div>
                                                                        <div class="col-6">
                                                                            <span style="font-size:22px; padding-top: 12px; text-align:left;">@Html.DisplayFor(model => model.Company.company_name)</span><br />
                                                                            <span>@Html.DisplayFor(model => model.Company.work_Address)</span><br />
                                                                            <span>@Html.DisplayFor(model => model.Company.work_Address2)</span><br />
                                                                            <div style="text-align: left;">
                                                                                @Html.Label("AT.POST :- ", new { @class = "col-form-label", @style = "padding: 0px;" })
                                                                                @Html.DisplayFor(model => Model.Company.city_name) @Html.DisplayFor(model => Model.Company.state_Name) @Html.DisplayFor(model => Model.Company.zip_code)  @Html.DisplayFor(model => Model.Company.country_name)
                                                                                <br />
                                                                                @Html.Label("GSTIN :-", htmlAttributes: new { @class = "col-form-label", @style = "padding: 0px;" })
                                                                                @Html.DisplayFor(model => Model.Company.gst_no, new { @class = "col-form-label", @style = "padding: 0px;" })
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-4">
                                                                            <h5 class="card-title mb-0" style="font-size:28px; padding-top: 12px; margin-top:70px; text-align:right;">Sale Delivery</h5>
                                                                        </div>
                                                                    </div>

                                                                    <div class="row" style="border-top:1px solid black ;">
                                                                        <div class="col-6" style="padding-top:5px; padding-bottom:5px; border-right:1px solid black;">
                                                                            <div class="row">
                                                                                <div class="col-12" style="padding-top:5px;">
                                                                                    <span style="font-weight:bold;"> @Html.DisplayFor(model => model.partymaster.party_name)</span>
                                                                                </div>
                                                                                <div class="col-12">
                                                                                    <span>@Html.DisplayFor(model => model.partymaster.billing_address)</span>
                                                                                </div>
                                                                                <div class="col-12">
                                                                                    <span>@Html.DisplayFor(model => model.partymaster.city_name) @Html.DisplayFor(model => model.partymaster.pin_no) @Html.DisplayFor(model => model.partymaster.state_name)</span><br />
                                                                                    <span>
                                                                                        India @*Html.DisplayFor(model => model.PartyMasterSearch.country_id) *@
                                                                                    </span><br />
                                                                                </div>
                                                                                <div class="col-12">
                                                                                    GSTIN  <span>@Html.DisplayFor(model => model.partymaster.gst_no)</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-6" style="padding-top:5px;">
                                                                            <div class="row">
                                                                                <div class="col-4">
                                                                                    Invoice No :
                                                                                </div>
                                                                                <div class="col-8">
                                                                                    <span style="font-weight:bold;">@Html.DisplayFor(model => model.InvoiceHeaderSearch.invoice_no)</span>
                                                                                </div>
                                                                            </div>

                                                                            <div class="row">
                                                                                <div class="col-4">
                                                                                    Invoice Date :
                                                                                </div>
                                                                                <div class="col-8">
                                                                                    @if (Model.InvoiceHeaderSearch != null)
                                                                                    {
                                                                                        <span style="font-weight:bold;">
                                                                                            @String.Format("{0:dd/MM/yyyy}", Model.InvoiceHeaderSearch.invoice_date)
                                                                                        </span>
                                                                                    }
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-12" style="min-height:0px; padding: 0px; font-size: 12px;">
                                                                    <style>
                                                                        .table_css th {
                                                                            padding: 5px 5px;
                                                                        }

                                                                        .table_css td {
                                                                            padding: 5px 5px;
                                                                        }
                                                                    </style>
                                                                    <table id="Invoice" class="table table-bordered table-hover table_css" style="border: 1px; margin-bottom: 0px; font-size: 12px;">
                                                                        @*<table class="table table-bordered dt-responsive table-nowrap table-striped align-middle app-tbl-one" style="width:100%;font-size: 12px;">*@
                                                                        @if (Model.InvoiceDetails != null)
                                                                        {
                                                                            foreach (var row in Model.InvoiceDetails)
                                                                            {
                                                                                if (MaterialId != row.material_id)
                                                                                {
                                                                                    if (TotalInvoiceQty != 0 && MaterialId != row.material_id)
                                                                                    {
                                                                                        <tr style="border:none;">
                                                                                            <td colspan="6" style="text-align:right; font-weight:bold; border:none;">Total:</td>
                                                                                            <td style="text-align:right; border:none; font-weight:bold;">@TotalInvoiceQty</td>
                                                                                            <td colspan="6" style="text-align:right; border:none; font-weight:bold;">@TotalInvoiceAmount</td>
                                                                                        </tr>

                                                                                        TotalInvoiceQty = 0;
                                                                                        TotalInvoiceAmount = 0;
                                                                                    }

                                                                                    SrNo = 0;
                                                                                    <tr style="padding-left:30px;border:none;">
                                                                                        <td colspan="10" style="border:none; padding-bottom: 0px;"><span style="font-weight:bold;color:#3c56a4;">Material Name : </span> <strong> @row.material_name </strong></td>
                                                                                    </tr>

                                                                                    <tr style="text-align:center;">
                                                                                        <th>SNo</th>
                                                                                        <th>Date</th>
                                                                                        <th>Vehicle No</th>
                                                                                        <th>DM No</th>
                                                                                        <th>Concrete Type</th>
                                                                                        <th>Site Name</th>
                                                                                        <th>Qty (M3)</th>
                                                                                        <th>Rate</th>
                                                                                        <th>Amount (Rs)</th>
                                                                                    </tr>
                                                                                }

                                                                                SrNo = SrNo + 1;
                                                                                <tr>
                                                                                    <td style="text-align:center;">@SrNo</td>
                                                                                    <td>@String.Format("{0:dd/MM/yyyy}", row.ticket_date_time)</td>
                                                                                    <td>@Html.DisplayFor(modelItem => row.vehicle_number)</td>
                                                                                    <td>@Html.DisplayFor(modelItem => row.dm_no)</td>
                                                                                    <td>@Html.DisplayFor(modelItem => row.concrete_type)</td>
                                                                                    <td>@Html.DisplayFor(modelItem => row.location_name)</td>

                                                                                    <td style="text-align: right; color: maroon;">@String.Format("{0:f2}", row.item_qty)</td>
                                                                                    <td style="text-align:right; color: green;">@Html.DisplayFor(modelItem => row.final_item_rate)</td>
                                                                                    <td style="text-align: right; color: green;">@Html.DisplayFor(modelItem => row.item_value)</td>
                                                                                </tr>
                                                                                MaterialId = row.material_id;
                                                                                TotalInvoiceQty = TotalInvoiceQty + row.item_qty;
                                                                                TotalInvoiceAmount = TotalInvoiceAmount + row.item_value;
                                                                                GrandTotalQty = GrandTotalQty + row.item_qty;
                                                                                GrandTotalAmount = GrandTotalAmount + row.item_value;
                                                                            }
                                                                        }

                                                                        <tr style="border:none;">
                                                                            <td colspan="6" style="text-align:right; font-weight:bold; border:none;">Total:</td>
                                                                            <td style="text-align:right; border:none; font-weight:bold;">@TotalInvoiceQty</td>
                                                                            <td colspan="6" style="text-align:right; border:none; font-weight:bold;">@TotalInvoiceAmount</td>
                                                                        </tr>

                                                                        <tr style="border:none;">
                                                                            <td colspan="6" style="text-align:right;font-weight:bold; border:none;">Grand Total:</td>
                                                                            <td style="text-align:right; border:none; font-weight:bold;">@GrandTotalQty</td>
                                                                            <td colspan="6" style="text-align:right; border:none; font-weight:bold;">@GrandTotalAmount</td>
                                                                        </tr>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}