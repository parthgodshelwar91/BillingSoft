@model ProBillInvoice.GrinModel

@{
    ViewBag.Title = "GRN_Ticket";
    int SrNo = 0;
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title mb-0 page-heading-color">Good Receipt Note - Create With Ticket</h4>
                    </div>

                    <div class="card-body">
                        <div class="form-group">
                            <fieldset style="border: 1px solid #e7dddd; border-radius: 10px; padding: 10px 10px 5px 10px; margin: 0px 0px 10px 0px;">
                                <div>
                                    @Html.HiddenFor(model => model.GrinHeaderSearch.grin_header_id)
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-4">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.party_id, htmlAttributes: new { @class = "form-label", @style = "float: left; padding: 10px 10px 0px 0px; color: #12566c; width: 30%;" })
                                        @Html.DropDownListFor(model => model.GrinHeaderSearch.party_id, (SelectList)ViewBag.PartyList, "---Select---", new { @class = "form-select", @style = "width: 70%;" })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.party_id, "", new { @class = "text-danger" })
                                    </div>
                                    <div class="col-md-4">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.company_id, new { @class = "form-label", @style = "float: left; padding: 10px 10px 0px 20px; color: #12566c;" })
                                        @Html.Label("*", htmlAttributes: new { style = "color: red; float: left; padding: 10px 10px 0px 0px;" })
                                        @Html.DropDownListFor(model => model.GrinHeaderSearch.company_id, (SelectList)ViewBag.CompanyMst, "-- Select--", new { @class = "form-select", @style = "float: left; width: 70%;" })
                                        @Html.ValidationMessageFor(model => Model.GrinHeaderSearch.company_id, "", new { @class = "text-danger" ,@style = "padding: 0px 0px 0px 120px;" })
                                    </div>
                                    <div class="col-md-4" style="text-align: right;">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.grin_no, new { @class = "form-label", @style = "padding: 10px 10px 0px 0px; color: #12566c;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.grin_no, new { htmlAttributes = new { @class = "form-control", @style = "float: right; font-weight: bold; color: navy; border:none; width: 50%;", @readonly = true, placeholder = "Enter Invoice No" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.grin_no, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.po_id, new { @class = "form-label", @style = "float: left; padding: 10px 10px 0px 0px; color: #12566c; width: 30%;" })
                                        @Html.DropDownListFor(model => model.GrinHeaderSearch.po_id, (SelectList)ViewBag.PurchaseHeader, "--Select--", new { @class = "form-select", @style = "width: 70%;", onchange = "this.form.submit();" })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.po_id, "", new { @class = "text-danger" })
                                    </div>
                                    <div class="col-md-4">
                                        @Html.Label("*", htmlAttributes: new { id = "lblPartyCode", @style = "margin: 0px; color: navy;" })
                                        <br />
                                        @Html.Label("*", htmlAttributes: new { id = "lblGSTStatus", @style = "margin: 0px; color: navy;" })
                                    </div>
                                    <div class="col-md-4" style="text-align: right;">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.grin_date, new { @class = "form-label", @style = "padding: 10px 10px 0px 0px; color: #12566c;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.grin_date, new { htmlAttributes = new { @type = "Date", @class = "form-control", @style = "float: right; width: 47%;" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.grin_date, "", new { @class = "text-danger" })
                                    </div>
                                    @*<div class="col-md-4" style="text-align: right;">
                                            @Html.LabelFor(model => model.GrinHeaderSearch.po_date, new { @class = "form-label", @style = "padding: 10px 10px 0px 0px; color: #12566c;" })
                                            @Html.EditorFor(model => model.GrinHeaderSearch.po_date, new { htmlAttributes = new { @type = "Date", @class = "form-control", @style = "float: right; width: 40%;", @readonly = true } })
                                            @Html.ValidationMessageFor(model => model.GrinHeaderSearch.po_date, "", new { @class = "text-danger" })
                                        </div>*@
                                </div>
                            </fieldset>

                            <fieldset style="border: 1px solid #e7dddd; border-radius: 10px; padding: 10px 10px 5px 10px; margin: 0px 0px 10px 0px; ">
                                <div class="row mb-1">
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.inv_no, new { @class = "form-label", @style = "float:left; padding: 10px 10px 0px 0px;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.inv_no, new { htmlAttributes = new { @class = "form-control", @style = "width: 50%;" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.inv_no, "", new { @class = "text-danger" })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.inv_date, new { @class = "form-label", @style = "float:left; padding: 10px 10px 0px 0px;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.inv_date, new { htmlAttributes = new { @class = "form-control", @style = "width: 50%;" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.inv_date, "", new { @class = "text-danger" })
                                    </div>

                                    <div class="col-md-3" style="text-align: right;">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.gate_no, new { @class = "form-label", @style = "padding: 10px 10px 0px 0px;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.gate_no, new { htmlAttributes = new { @class = "form-control", @style = "float: right; width: 50%;" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.gate_no, "", new { @class = "text-danger" })
                                    </div>

                                    <div class="col-md-3" style="text-align: right;">
                                        @Html.LabelFor(model => model.GrinHeaderSearch.gate_date, new { @class = "form-label", @style = "padding: 10px 10px 0px 0px;" })
                                        @Html.EditorFor(model => model.GrinHeaderSearch.gate_date, new { htmlAttributes = new { @type = "Date", @class = "form-control", @style = "float: right; width: 50%;" } })
                                        @Html.ValidationMessageFor(model => model.GrinHeaderSearch.gate_date, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </fieldset>

                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <div class="table-responsive" style="height:250px;">
                                        <table id="GrinDetail" class="table table-bordered table-hover table-responsive table-striped align-middle table-rmc table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Select</th>
                                                    <th>Slip No</th>
                                                    <th>Item Name</th>
                                                    <th>Unit</th>
                                                    <th>Remark</th>
                                                    <th style="text-align:right">Pend Qty</th>
                                                    <th>Rec Qty</th>
                                                    <th>Acce Qty</th>
                                                    <th style="text-align:right">Rej Qty</th>
                                                    <th style="text-align:right">Rate</th>
                                                    <th style="text-align:right">Sub Total</th>
                                                    <th style="text-align:right">Cgst(%)</th>
                                                    <th style="text-align:right">Sgst(%)</th>
                                                    <th style="text-align:right">Igst(%)</th>
                                                    <th style="text-align:right;"><i class="bx bx-rupee"></i> Amount</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                @if (Model.GrinDetail != null)
                                                {
                                                    for (var i = 0; i < Model.GrinDetail.Count(); i++)
                                                    {
                                                        SrNo = SrNo + 1;
                                                        <tr>
                                                            <td style="padding-top: 12px;">@Html.CheckBoxFor(x => Model.GrinDetail[i].is_select, new { @onclick = "ItemCalculation();", @style = "border: none; background-color: transparent; width: 100%;" })</td>
                                                            <td style="width: 120px;">@Html.DisplayFor(x => Model.GrinDetail[i].slip_no)</td>
                                                            <td style="width: 120px;">@Html.DisplayFor(x => Model.GrinDetail[i].material_name)</td>
                                                            <td style="width: 100px;">@Html.DisplayFor(x => Model.GrinDetail[i].short_desc)</td>
                                                            <td>@Html.TextBoxFor(x => Model.GrinDetail[i].remarks, new { @class = "form-control form-control-sm", @style = "width: 100%;" })</td>

                                                            <td style="width: 100px;">@Html.TextBoxFor(x => Model.GrinDetail[i].pend_qty, new { @class = "form-control form-control-sm", @style = "text-align: right; color: maroon; border: none; background-color: transparent; font-weight: bold; width: 100%;", @readonly = "readonly" })</td>
                                                            <td>@Html.TextBoxFor(x => Model.GrinDetail[i].rece_qty, new { @class = "form-control form-control-sm", @style = "text-align: right; color: maroon; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            <td>@Html.TextBoxFor(x => Model.GrinDetail[i].acce_qty, new { @class = "form-control form-control-sm", @style = "text-align: right; color: maroon; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            <td style="width: 100px;">@Html.TextBoxFor(x => Model.GrinDetail[i].rej_qty, new { @class = "form-control form-control-sm", @style = "text-align: right; color: maroon; border: none; background-color: transparent; font-weight: bold; width: 100%;", @readonly = "readonly" })</td>
                                                            <td>@Html.TextBoxFor(x => Model.GrinDetail[i].item_rate, new { @class = "form-control form-control-sm", @style = "text-align: right; color: green; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            
                                                            <td style="width: 100px;">@Html.TextBoxFor(x => Model.GrinDetail[i].sub_total, new { @class = "form-control form-control-sm", @style = "text-align: right; color: green; border: none; background-color: transparent; font-weight: bold; width: 100%;", @readonly = "readonly" })</td>
                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinDetail[i].cgst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinDetail[i].sgst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinDetail[i].igst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "ItemCalculation();" })</td>
                                                            <td style="width: 100px;">@Html.TextBoxFor(x => Model.GrinDetail[i].item_value, new { @class = "form-control form-control-sm", @style = "text-align: right; color: green; border: none; background-color: transparent; font-weight: bold; width: 100%;", @readonly = "readonly" })</td>

                                                            @Html.HiddenFor(x => Model.GrinDetail[i].grin_detail_id)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].grin_header_id)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].material_id)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].material_name)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].unit_code)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].short_desc)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].ticket_number)
                                                            @Html.HiddenFor(x => Model.GrinDetail[i].slip_no)
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <fieldset class="total-value-strip mt-2" style="border: 1px solid #e7dddd; border-radius: 10px; padding: 0px 10px 0px 10px; margin: 0px 0px 10px 0px; " >
                                <div class="row">
                                    <div class="col-md-6">
                                        @*@Html.Label("No Of Vehicle :", new { @class = "col-form-label", @style = "float: left; padding: 10px 10px 10px 10px;" })
                                            @Html.Label(" ", new { @class = "col-form-label", @id = "lblVehicleNo" })*@
                                    </div>

                                    <div class="col-md-6" style="text-align: right;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                @Html.Label("Total Qty :", new { @class = "col-form-label", @style = "padding: 10px 10px 10px 10px;" })
                                                @Html.Label(" ", new { @class = "col-form-label", @id = "lblQty", @style = "color:green" })
                                            </div>
                                            <div class="col-md-3">
                                                @Html.Label("Sub Total :", new { @class = "col-form-label", @style = "padding: 10px 10px 10px 10px;", })
                                                <span class="input-group-addon" style="color:green">₹</span>
                                            </div>
                                            <div class="col-md-3">
                                                @Html.EditorFor(model => model.GrinHeaderSearch.basic_amount, "", new { htmlAttributes = new { @class = "form-control", @style = "text-align: right; border: none; color: green; background-color: transparent; padding: 12px; font-weight: bold;", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            <fieldset style="border: 1px solid #e7dddd; border-radius: 10px; padding: 0px 10px 0px 10px;">
                                <div class="row mb-2" style="padding: 10px 0px 0px 0px;">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div class="row mb-2">
                                                <div class="col-md-12">
                                                    @Html.LabelFor(model => model.GrinHeaderSearch.transporter, htmlAttributes: new { @class = "col-form-label", @style = "float: left; padding: 10px 10px 0px 0px; width: 20%;" })
                                                    @Html.TextBoxFor(model => model.GrinHeaderSearch.transporter, new { @class = "form-control", @style = "float: left; width: 60%;", placeholder = "Enter Transporter" })
                                                    @Html.ValidationMessageFor(model => model.GrinHeaderSearch.transporter, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="row mb-2">
                                                <div class="col-md-12">
                                                    @Html.LabelFor(model => model.GrinHeaderSearch.vehicle_no, htmlAttributes: new { @class = "col-form-label", @style = "float: left; padding: 10px 10px 0px 0px; width: 20%;" })
                                                    @Html.TextBoxFor(model => model.GrinHeaderSearch.vehicle_no, new { @class = "form-control", @style = "float: left; width: 60%;", placeholder = "Enter Vehicle Number" })
                                                    @Html.ValidationMessageFor(model => model.GrinHeaderSearch.vehicle_no, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="row mb-2">
                                                <div class="col-md-12">
                                                    @Html.LabelFor(model => model.GrinHeaderSearch.payterm_code, htmlAttributes: new { @class = "col-form-label", @style = "float: left; padding: 10px 10px 0px 0px; width: 20%;" })
                                                    @Html.DropDownListFor(model => model.GrinHeaderSearch.payterm_code, (SelectList)ViewBag.Payterm, "--Select--", new { @class = "form-select", @style = "float: left; margin-right: 10px; width: 50%;" })
                                                    @*@Html.TextBoxFor(model => model.GrinHeaderSearch.payterm_days, new { @class = "form-control", @style = "width: 9%;" @Value = "0"  , @style = "padding: 0px 0px 0px 215px;"})*@
                                                    @Html.TextBoxFor(model => model.GrinHeaderSearch.payterm_days, new { @class = "form-control", @style = "width: 9%;", @Value = "0" })
                                                    @Html.ValidationMessageFor(model => model.GrinHeaderSearch.payterm_code, "", new { @class = "text-danger"})
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    @Html.LabelFor(model => model.GrinHeaderSearch.remarks, htmlAttributes: new { @class = "col-form-label", @style = "float: left; padding: 10px 10px 0px 0px; width: 20%;" })
                                                    @Html.TextAreaFor(model => model.GrinHeaderSearch.remarks, 2, 20, new { @class = "form-control", @style = "float: left; width: 60%;", placeholder = "Enter Remark"})
                                                    @Html.ValidationMessageFor(model => model.GrinHeaderSearch.remarks, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top: 10px;">
                                                <div class="table-responsive">
                                                    <fieldset>
                                                        <table id="GRNTax" class="table table-bordered table-hover table-responsive table-striped align-middle table-rmc table-sm">
                                                            <thead>
                                                                <tr>
                                                                    <th>Taxation</th>
                                                                    <th style="text-align:right;"><i class="bx bx-rupee"></i> Amount</th>
                                                                    <th style="text-align:right">Cgst(%)</th>
                                                                    <th style="text-align:right">Sgst(%)</th>
                                                                    <th style="text-align:right">Igst(%)</th>
                                                                    <th style="text-align:right;"><i class="bx bx-rupee"></i> Tax Amt</th>                                                                  
                                                                </tr>
                                                            </thead>

                                                            <tbody>
                                                                @if (Model.GrinTax != null)
                                                                {
                                                                    for (var i = 0; i < Model.GrinTax.Count(); i++)
                                                                    {
                                                                        <tr>
                                                                            <td>@Html.DropDownListFor(x => Model.GrinTax[i].acct_id, new SelectList(ViewBag.AccountList, "Value", "Text", Model.GrinTax[i].acct_id), "--Select--", new { @class = "form-select" })</td>
                                                                            <td>@Html.TextBoxFor(x => Model.GrinTax[i].basic_amount, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "TaxCalculation(" + i.ToString() + ");" })</td>
                                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinTax[i].cgst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "TaxCalculation(" + i.ToString() + ");" })</td>
                                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinTax[i].sgst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "TaxCalculation(" + i.ToString() + ");" })</td>
                                                                            <td style="width: 80px;">@Html.TextBoxFor(x => Model.GrinTax[i].igst, new { @class = "form-control form-control-sm", @style = "text-align: right; width: 100%;", @onchange = "TaxCalculation(" + i.ToString() + ");" })</td>
                                                                            <td>@Html.TextBoxFor(x => Model.GrinTax[i].tax_amount, new { @readonly = "readonly", @style = "text-align: right; border: none; background-color: transparent; color: green; width: 100%;" })</td>
                                                                            @Html.HiddenFor(x => Model.GrinTax[i].tax_id)
                                                                        </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>

                                                        <div class="row">
                                                            <div class="col-md-8">
                                                                <button type="submit" id="btnAdd" class="btn btn-primary addMembers-modal" style="padding: 2px 10px 2px 10px; margin-top: 30px;" name="btnAdd" value="Add" formaction="GRN_Ticket" formmethod="post">
                                                                    <div style="float: left; padding: 0 5px 0 0;">
                                                                        <i class="bx bx-plus"></i>
                                                                    </div>Add
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            <fieldset class="total-value-strip mt-2">
                                <div class="row">
                                    <div class="col-md-10" style=" text-align: right;">
                                        @Html.Label("Total Amount :", new { @class = "col-form-label", @style = "padding: 0px;" })
                                        @Html.Label("₹", htmlAttributes: new { @style = "color: green; font-size: 18px;margin-bottom: 0px;" })
                                    </div>
                                    <div class="col-md-2 text-end">
                                        @Html.EditorFor(model => model.GrinHeaderSearch.total_amount, new { htmlAttributes = new { @class = "form-control", @readonly = true, @style = "text-align: right; color: green; padding: 0px; border: none; background-color: transparent; font-weight: bold; font-size:18px;" } })
                                    </div>
                                </div>
                            </fieldset>

                            <div class="row">
                                <div class="col-md-12 text-end">
                                    <a href="@Url.Action("Index", "Grin")" class="back-btn"><i class="las la-arrow-circle-left"></i>Back</a>
                                    <button type="submit" id="btnAdd" class="save-data-btn" name="btnAdd" value="Save" formmethod="post" formaction="GRN_Ticket"><i class="ri-save-2-line"></i>Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@if (ViewBag.Message != null)
{
    <script>
        window.onload = function () {

            Swal.fire({
                title: "<span style='color: #3085d6;'>@Html.Raw(ViewBag.Message)</span>",
                icon: "success",
                iconColor:"#04AA6D",
                confirmButtonClass: "w-xs me-2 mt-2",
                confirmButtonColor: "#3085d6",

            }).then((result) => {
                if (result.value) {
                    window.location.href = "@Url.Action("Index", "Grin")";
                }
            });
        } ;
    </script>
}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $(document).ready(function () {
            $("#GrinHeaderSearch_company_id").change(function () {
                var selectedText = $(this).find("option:selected").text();
                var selectedValue = $(this).val();
                var SGM = {
                    Company_id: selectedValue,
                    Company_name: selectedText
                };
                $.ajax({
                    type: "POST",
                    url: "/Grin/GRNNO",
                    data: JSON.stringify(SGM),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        results = data.msg;
                        $('#GrinHeaderSearch_grin_no').val(results);
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })
        })
    </script>

    <script>
        function ItemCalculation() {
            var i = 0;
            var Amount = 0.00;
            var TotalQty = 0.00;
            $("#GrinDetail tr").each(function () {
                var PendQty = $("#GrinDetail_" + i.toString() + "__pend_qty").val();
                var ReceQty = $("#GrinDetail_" + i.toString() + "__rece_qty").val();
                var AcceQty = $("#GrinDetail_" + i.toString() + "__acce_qty").val();

                if (parseFloat(ReceQty) > parseFloat(PendQty)) {
                    alert("Received Qty should not greater than Pending Qty!");
                    $("#GrinDetail_" + i.toString() + "__rece_qty").val('0.00');
                    $("#GrinDetail_" + i.toString() + "__acce_qty").val('0.00');
                    $("#GrinDetail_" + i.toString() + "__rej_qty").val('0.00');
                    ReceQty = $("#GrinDetail_" + i.toString() + "__rece_qty").val();
                    AcceQty = $("#GrinDetail_" + i.toString() + "__acce_qty").val();
                }

                if (parseFloat(AcceQty) > parseFloat(ReceQty)) {
                    alert("Accepted Qty should not greater than Received Qty!");
                    $("#GrinDetail_" + i.toString() + "__acce_qty").val('0.00');
                    $("#GrinDetail_" + i.toString() + "__rej_qty").val('0.00');
                    ReceQty = $("#GrinDetail_" + i.toString() + "__rece_qty").val();
                    AcceQty = $("#GrinDetail_" + i.toString() + "__acce_qty").val();
                }

                var RejQty = parseFloat(ReceQty) - parseFloat(AcceQty);
                $("#GrinDetail_" + i.toString() + "__rej_qty").val(RejQty.toFixed(2));

                var CgstTotal = 0.00;
                var SgstTotal = 0.00;
                var IgstTotal = 0.00;
                var Total = 0.00;
                var Rate = $("#GrinDetail_" + i.toString() + "__item_rate").val();
                var Cgst = $("#GrinDetail_" + i.toString() + "__cgst").val();
                var Sgst = $("#GrinDetail_" + i.toString() + "__sgst ").val();
                var Igst = $("#GrinDetail_" + i.toString() + "__igst ").val();
                check = $("#GrinDetail_" + i.toString() + "__is_select").prop("checked");
                var SubTotal = AcceQty * Rate;
                if (Cgst != 0) {
                    CgstTotal = SubTotal * (Cgst / 100);
                }
                if (Sgst != 0) {
                    SgstTotal = SubTotal * (Sgst / 100);
                }
                if (Igst != 0) {
                    IgstTotal = SubTotal * (Igst / 100);
                }
                if (check) {
                    Total = SubTotal + CgstTotal + SgstTotal + IgstTotal;
                    if (!isNaN(Total)) {
                        Amount += Total;
                    }
                }
                if (!isNaN(AcceQty)) {
                    TotalQty += parseFloat(AcceQty);
                }
                $("#GrinDetail_" + i.toString() + "__sub_total").val(SubTotal.toFixed(2));
                $("#GrinDetail_" + i.toString() + "__item_value").val(Total.toFixed(2));
                i++;
            });
            var j = 0;
            var Amount1 = 0.00;
            var Taxamt = 0.00;
            var Totalsmt = 0.00;
            $("#GRNTax tr").each(function () {
                Taxamt = $("#GrinTax_" + j.toString() + "__tax_amount").val();
                if (!isNaN(Taxamt)) {
                    Amount1 += parseFloat(Taxamt);
                }
                j++;
            });
            $("#GrinHeaderSearch_basic_amount").val(Amount.toFixed(2));
            Totalsmt = parseFloat(Amount) + parseFloat(Amount1);
            $("#GrinHeaderSearch_total_amount").val(Math.round(Totalsmt).toFixed(2));
            document.getElementById('lblQty').innerHTML = TotalQty.toFixed(2);
        }
    </script>

    <script>
        function TaxCalculation() {
            var i = 0;
            var TotalTaxAmt = 0.00;
            $("#GRNTax tr").each(function () {
                var cgstTotal = 0.00;
                var sgstTotal = 0.00;
                var IgstTotal = 0.00;
                var TaxAmt = 0.00;
                var BasicTaxAmt = $("#GrinTax_" + i.toString() + "__basic_amount").val();
                var cgst = $("#GrinTax_" + i.toString() + "__cgst").val();
                var sgst = $("#GrinTax_" + i.toString() + "__sgst").val();
                var Igst = $("#GrinTax_" + i.toString() + "__igst ").val();
                if (cgst != 0) {
                    cgstTotal = BasicTaxAmt * (cgst / 100);
                }
                if (sgst != 0) {
                    sgstTotal = BasicTaxAmt * (sgst / 100);
                }
                if (Igst != 0) {
                    IgstTotal = BasicTaxAmt * (Igst / 100);
                }
                TaxAmt = parseFloat(BasicTaxAmt) + parseFloat(cgstTotal) + parseFloat(sgstTotal) + parseFloat(IgstTotal);
                if (!isNaN(TaxAmt)) {
                    TotalTaxAmt += parseFloat(TaxAmt);
                }
                $("#GrinTax_" + i.toString() + "__tax_amount").val(TaxAmt.toFixed(2));
                i++;
            });

            var BasicAmount = $("#GrinHeaderSearch_basic_amount").val();
            var TotalAmount = parseFloat(TotalTaxAmt) + parseFloat(BasicAmount);
            $("#GrinHeaderSearch_total_amount").val(Math.round(TotalAmount).toFixed(2));
        }
    </script>


    <script>
        function AjFunction(GSTStatus) {
            if (GSTStatus === "Within State Supplier") {
                $('#GrinDetail th:nth-child(12)').show();
                $('#GrinDetail td:nth-child(12)').show();
                $('#GrinDetail th:nth-child(13)').show();
                $('#GrinDetail td:nth-child(13)').show();
                $('#GrinDetail th:nth-child(14)').hide();
                $('#GrinDetail td:nth-child(14)').hide();
            } else {               
                $('#GrinDetail th:nth-child(12)').hide();
                $('#GrinDetail td:nth-child(12)').hide();
                $('#GrinDetail th:nth-child(13)').hide();
                $('#GrinDetail td:nth-child(13)').hide();
                $('#GrinDetail th:nth-child(14)').show();
                $('#GrinDetail td:nth-child(14)').show();
            }

            if (GSTStatus === "Within State Supplier") {
                $('#GRNTax th:nth-child(3)').show();
                $('#GRNTax td:nth-child(3)').show();
                $('#GRNTax th:nth-child(4)').show();
                $('#GRNTax td:nth-child(4)').show();
                $('#GRNTax th:nth-child(5)').hide();
                $('#GRNTax td:nth-child(5)').hide();
            } else {
                $('#GRNTax th:nth-child(3)').hide();
                $('#GRNTax td:nth-child(3)').hide();
                $('#GRNTax th:nth-child(4)').hide();
                $('#GRNTax td:nth-child(4)').hide();
                $('#GRNTax th:nth-child(5)').show();
                $('#GRNTax td:nth-child(5)').show();
            }
        }

        $(document).ready(function () {
            $("#GrinHeaderSearch_party_id").change(function () {
                var selectedText = $(this).find("option:selected").text();
                var selectedValue = $(this).val();

                var lsParameter = {
                    PartyId: selectedValue,
                    PartyName: selectedText
                };
                $.ajax({
                    type: "POST",
                    url: "/Grin/PartyDetail",
                    data: JSON.stringify(lsParameter),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        PartyCode = data.msg.split("|")[0];
                        PartyAddress = data.msg.split("|")[1];
                        GSTStatus = data.msg.split("|")[2];
                        $('#lblPartyCode').text(PartyCode);
                        $('#lblPartyAddress').text(PartyAddress);
                        $('#lblGSTStatus').text(GSTStatus);
                        AjFunction(GSTStatus); // Call the AjFunction with GSTStatus
                    },
                    error: function () {
                        $('#lblPartyCode').text('*');
                        $('#lblPartyAddress').text('*');
                        $('#lblGSTStatus').text('*');
                    }
                });
            })
        })

        $(document).ready(function () {
            var selectedText = $("#GrinHeaderSearch_party_id").find("option:selected").text();
            var selectedValue = $("#GrinHeaderSearch_party_id").val();

            var lsParameter = {
                PartyId: selectedValue,
                PartyName: selectedText
            };
            $.ajax({
                type: "POST",
                url: "/Grin/PartyDetail",
                data: JSON.stringify(lsParameter),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    PartyCode = data.msg.split("|")[0];
                    PartyAddress = data.msg.split("|")[1];
                    GSTStatus = data.msg.split("|")[2];
                    $('#lblPartyCode').text(PartyCode);
                    $('#lblPartyAddress').text(PartyAddress);
                    $('#lblGSTStatus').text(GSTStatus);
                    AjFunction(GSTStatus); // Call the AjFunction with GSTStatus
                },
                error: function () {
                    $('#lblPartyCode').text('*');
                    $('#lblPartyAddress').text('*');
                    $('#lblGSTStatus').text('*');
                }
            });
        })
    </script>

    <script>
        $(document).ready(function () {
            $("#GrinHeaderSearch_party_id").change(function () {
                var selectedText = $(this).find("option:selected").text();
                var selectedValue = $(this).val();
                var SGM = {
                    PartyNo: selectedValue,
                    PartyName: selectedText
                };
                $.ajax({
                    type: "POST",
                    url: "/Grin/FillByPurchaseNo",
                    data: JSON.stringify(SGM),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        data.List;
                        var items = '';
                        items = "<option>---Select---</option>";
                        $.each(data.List, function (i, SGrCode) {
                            items += "<option value='" + SGrCode.Value + "'>" + SGrCode.Text + "</option>";
                        });
                        $("#GrinHeaderSearch_po_id").html(items);
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })
        })
    </script>


}


@*<script>
        $(document).ready(function () {
            $("#GrinHeaderSearch_party_id").change(function () {
                var selectedText = $(this).find("option:selected").text();
                var selectedValue = $(this).val();

                var lsParameter = {
                    PartyId: selectedValue,
                    PartyName: selectedText
                };
                $.ajax({
                    type: "POST",
                    url: "/Grin/PartyDetail",
                    data: JSON.stringify(lsParameter),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        PartyCode = data.msg.split("|")[0];
                        PartyAddress = data.msg.split("|")[1];
                        GSTStatus = data.msg.split("|")[2];
                        $('#lblPartyCode').text(PartyCode);
                        $('#lblPartyAddress').text(PartyAddress);
                        $('#lblGSTStatus').text(GSTStatus);
                        AjFunction(GSTStatus); // Call the AjFunction with GSTStatus
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            })
        })
    </script>

    <script>
        function CheckBoxClick() {
            var i = 0;
            var amount = 0.00;
            var totalQty = 0.00;
            var GrandSubTotal = 0.00;
            $("#GrinTicket tr").each(function () {
                check = $("#TicketList_" + i.toString() + "__is_valid").prop("checked");
                if (check) {
                    var cgstTotal = 0.00;
                    var sgstTotal = 0.00;
                    var IgstTotal = 0.00;
                    var qty = $("#TicketList_" + i.toString() + "__qty_in_cft").val();
                    var rate = $("#TicketList_" + i.toString() + "__material_rate").val();
                    var cgst = $("#TicketList_" + i.toString() + "__CGST").val();
                    var sgst = $("#TicketList_" + i.toString() + "__SGST").val();
                    var Igst = $("#TicketList_" + i.toString() + "__IGST ").val();
                    var GrossWt = $("#TicketList_" + i.toString() + "__gross_weight").val();
                    var TareWt = $("#TicketList_" + i.toString() + "__tare_weight").val();
                    var CalculateKWH = GrossWt - TareWt;
                    var subtotal = qty * rate;
                    if (!isNaN(subtotal)) {
                        GrandSubTotal += subtotal;
                    }
                    if (cgst != 0) {
                        var cgstTotal = subtotal * (cgst / 100);
                    }
                    if (sgst != 0) {
                        sgstTotal = subtotal * (sgst / 100);
                    }
                    if (Igst != 0) {
                        IgstTotal = subtotal * (Igst / 100);
                    }
                    var total = subtotal + cgstTotal + sgstTotal + IgstTotal + CalculateKWH;
                    if (!isNaN(total)) {
                        amount += total;
                    }
                    if (!isNaN(qty)) {
                        totalQty += parseFloat(qty);
                    }

                    $("#TicketList_" + i.toString() + "__net_weight").val(CalculateKWH);
                    $("#TicketList_" + i.toString() + "__sub_total").val(subtotal.toFixed(2));
                    $("#TicketList_" + i.toString() + "__total_amount").val(total.toFixed(2));
                }
                i++;
            });

            var j = 0;
            var amount1 = 0.00;
            var taxamt = 0.00;
            var totoalsmt = 0.00;
            $("#GRNTax tr").each(function () {
                taxamt = $("#GrinTax_" + j.toString() + "__tax_amount").val();
                if (!isNaN(taxamt)) {
                    amount1 += parseFloat(taxamt);
                }
                j++;
            });
            $("#GrinHeaderSearch_basic_amount").val(GrandSubTotal.toFixed(2));
            var totoalsmt = parseFloat(amount) + parseFloat(amount1);
            $("#GrinHeaderSearch_total_amount").val(totoalsmt.toFixed(2));
            document.getElementById('lblQty').innerHTML = totalQty.toFixed(2);
        }
    </script>

     <script>
        function Calculation() {
            var i = 0;
            var Amount = 0.00;
            var TotalQty = 0.00;
            $("#GrinTicket tr").each(function () {
                var cgstTotal = 0.00;
                var sgstTotal = 0.00;
                var IgstTotal = 0.00;
                var Total = 0.00;
                var Qty = $("#TicketList_" + i.toString() + "__qty_in_cft").val();
                var Rate = $("#TicketList_" + i.toString() + "__material_rate").val();
                var cgst = $("#TicketList_" + i.toString() + "__CGST").val();
                var sgst = $("#TicketList_" + i.toString() + "__SGST").val();
                var Igst = $("#TicketList_" + i.toString() + "__IGST ").val();
                var GrossWt = $("#TicketList_" + i.toString() + "__gross_weight").val();
                var TareWt = $("#TicketList_" + i.toString() + "__tare_weight").val();
                check = $("#TicketList_" + i.toString() + "__is_valid").prop("checked");

                var CalculateKWH = GrossWt - TareWt;
                var Subtotal = Qty * Rate;
                if (cgst != 0) {
                    var cgstTotal = Subtotal * (cgst / 100);
                }
                if (sgst != 0) {
                    sgstTotal = Subtotal * (sgst / 100);
                }
                if (Igst != 0) {
                    IgstTotal = Subtotal * (Igst / 100);
                }

                if (check) {
                    Total = Subtotal + cgstTotal + sgstTotal + IgstTotal + CalculateKWH;
                    if (!isNaN(Total)) {
                        Amount += Total;
                    }
                }

                if (!isNaN(Qty)) {
                    TotalQty += parseFloat(Qty);
                }

                $("#TicketList_" + i.toString() + "__net_weight").val(CalculateKWH);
                $("#TicketList_" + i.toString() + "__sub_total").val(Subtotal.toFixed(2));
                $("#TicketList_" + i.toString() + "__total_amount").val(Total.toFixed(2));
                i++;
            });

            var j = 0;
            var Amount1 = 0.00;
            var Taxamt = 0.00;
            var Totalsmt = 0.00;
            $("#GRNTax tr").each(function () {
                Taxamt = $("#GrinTax_" + j.toString() + "__tax_amount").val();
                if (!isNaN(Taxamt)) {
                    Amount1 += parseFloat(Taxamt);
                }
                j++;
            });
            $("#GrinHeaderSearch_basic_amount").val(Amount.toFixed(2));
            Totalsmt = parseFloat(Amount) + parseFloat(Amount1);
            $("#GrinHeaderSearch_total_amount").val(Totalsmt.toFixed(2));
            document.getElementById('lblQty').innerHTML = TotalQty.toFixed(2);
        }
    </script>*@